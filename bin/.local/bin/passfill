#!/bin/sh

if [ -z "$DISPLAY" ]; then
	menu=fzf
else
	menu=dmenu
fi

account="$(gopass ls --flat | $menu | xargs -r gopass find | head -n1)"
entry="$(gopass show "$account")"

if [ -z "$DISPLAY" ]; then
	gopass -o "$account" | tmux load-buffer -
else
	echo "$entry" | grep "login:" | cut -d' '  -f2 | xclip
	echo "$entry" | grep "url:" | cut -d' '  -f2 | xargs -r $BROWSER
	gopass -c "$account"
	gopass otp "$account" | xargs -r notify-send -t 60000
fi
